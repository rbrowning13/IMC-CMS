{% extends "base.html" %}
{% block title %}New Claim{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">New Claim</h1>
    <a href="{{ url_for('main.claims_list') }}" class="btn btn-sm btn-outline-secondary">
      Cancel
    </a>
  </div>

  {% if error %}
    <div class="alert alert-danger alert-sm py-2 mb-3">
      {{ error }}
    </div>
  {% endif %}

  <div class="card">
    <div class="card-body">
      <form method="post">
        {% include "_claim_form.html" %}

        <div class="d-flex justify-content-end mt-3">
          <a href="{{ url_for('main.claims_list') }}" class="btn btn-sm btn-outline-secondary me-2">
            Cancel
          </a>
          <button type="submit" class="btn btn-sm btn-primary">
            Create Claim
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script>
    (function() {
      const carrierSelect = document.querySelector('select[name="carrier_id"]');
      const contactSelect = document.getElementById('carrier_contact_select');
      if (!carrierSelect || !contactSelect) return;

      const allOptions = Array.from(contactSelect.querySelectorAll('option[data-carrier-id]'));

      function updateContacts() {
        const carrierId = carrierSelect.value;
        contactSelect.value = '';
        let hasOptions = false;

        allOptions.forEach(function(opt) {
          if (opt.getAttribute('data-carrier-id') === carrierId) {
            opt.hidden = false;
            hasOptions = true;
          } else {
            opt.hidden = true;
          }
        });

        contactSelect.disabled = !hasOptions;
      }

      // Initialize: hide all contact options and disable select until a carrier is chosen
      allOptions.forEach(function(opt) { opt.hidden = true; });
      contactSelect.disabled = true;

      carrierSelect.addEventListener('change', updateContacts);
    })();
  </script>
{% endblock %}